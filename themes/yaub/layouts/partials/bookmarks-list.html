{{/* Saved Bookmarks List - Shows user's locally saved articles */}}
<div class="bookmarks-section" id="bookmarks-section">
    <h3 class="bookmarks-title">
        <i class="fas fa-bookmark"></i> 
        Saved Articles
        <span class="bookmarks-count" style="display: none;">0</span>
    </h3>
    
    <div class="bookmarks-empty" id="bookmarks-empty">
        <p>No saved articles yet.</p>
        <p class="bookmarks-hint">Click the "Save" button on any article to bookmark it for later.</p>
    </div>
    
    <ul class="bookmarks-list" id="bookmarks-list"></ul>
    
    <button class="bookmarks-clear-btn" id="bookmarks-clear" style="display: none;">
        <i class="fas fa-trash-alt"></i> Clear All
    </button>
</div>

<script>
(function() {
    const STORAGE_KEY = 'blog-bookmarks';
    
    function getBookmarks() {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        } catch (e) {
            return [];
        }
    }
    
    function saveBookmarks(bookmarks) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(bookmarks));
    }
    
    function removeBookmark(url) {
        let bookmarks = getBookmarks();
        bookmarks = bookmarks.filter(b => b.url !== url);
        saveBookmarks(bookmarks);
        renderBookmarks();
        
        // Update bookmark button if on same page
        const btn = document.querySelector('.bookmark-btn[data-url="' + url + '"]');
        if (btn) {
            btn.classList.remove('bookmarked');
            const icon = btn.querySelector('.bookmark-icon');
            const text = btn.querySelector('.bookmark-text');
            if (icon) {
                icon.classList.remove('fas');
                icon.classList.add('far');
            }
            if (text) text.textContent = 'Save';
        }
    }
    
    function renderBookmarks() {
        const bookmarks = getBookmarks();
        const list = document.getElementById('bookmarks-list');
        const empty = document.getElementById('bookmarks-empty');
        const clearBtn = document.getElementById('bookmarks-clear');
        const countEl = document.querySelector('.bookmarks-count');
        
        if (!list) return;
        
        // Update count
        if (countEl) {
            countEl.textContent = bookmarks.length;
            countEl.style.display = bookmarks.length > 0 ? 'inline-block' : 'none';
        }
        
        if (bookmarks.length === 0) {
            list.innerHTML = '';
            if (empty) empty.style.display = 'block';
            if (clearBtn) clearBtn.style.display = 'none';
            return;
        }
        
        if (empty) empty.style.display = 'none';
        if (clearBtn) clearBtn.style.display = 'block';
        
        list.innerHTML = bookmarks.map(b => `
            <li class="bookmark-item">
                <a href="${b.url}" class="bookmark-link">
                    <span class="bookmark-item-title">${b.title}</span>
                    <span class="bookmark-item-meta">
                        <span class="bookmark-item-section">${b.section}</span>
                        ${b.date ? '<span class="bookmark-item-date">' + b.date + '</span>' : ''}
                    </span>
                </a>
                <button class="bookmark-remove" data-url="${b.url}" title="Remove bookmark">
                    <i class="fas fa-times"></i>
                </button>
            </li>
        `).join('');
        
        // Add remove handlers
        list.querySelectorAll('.bookmark-remove').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                removeBookmark(this.dataset.url);
            });
        });
    }
    
    function clearAllBookmarks() {
        if (confirm('Remove all saved articles?')) {
            localStorage.removeItem(STORAGE_KEY);
            renderBookmarks();
            
            // Update any bookmark buttons on page
            document.querySelectorAll('.bookmark-btn.bookmarked').forEach(btn => {
                btn.classList.remove('bookmarked');
                const icon = btn.querySelector('.bookmark-icon');
                const text = btn.querySelector('.bookmark-text');
                if (icon) {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                }
                if (text) text.textContent = 'Save';
            });
        }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        renderBookmarks();
        
        const clearBtn = document.getElementById('bookmarks-clear');
        if (clearBtn) {
            clearBtn.addEventListener('click', clearAllBookmarks);
        }
    });
    
    // Listen for storage changes (cross-tab sync)
    window.addEventListener('storage', function(e) {
        if (e.key === STORAGE_KEY) {
            renderBookmarks();
        }
    });
})();
</script>

<style>
.bookmarks-section {
    padding: 1rem;
    background: var(--MENU-SECTIONS-BG-color, #f5f5f5);
    border-radius: 8px;
    margin: 1rem 0;
    /* Prevent horizontal overflow */
    overflow: hidden;
    max-width: 100%;
}

.bookmarks-title {
    font-size: 1rem;
    margin: 0 0 1rem 0;
    color: var(--MAIN-TEXT-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bookmarks-title i {
    color: var(--MAIN-LINK-color, #1e90ff);
}

.bookmarks-count {
    background: var(--BTN-BG-color-DARK, #1e90ff);
    color: white;
    font-size: 0.75rem;
    padding: 0.15rem 0.5rem;
    border-radius: 10px;
    margin-left: auto;
}

.bookmarks-empty {
    text-align: center;
    color: var(--MAIN-TEXT-color-DARK, #666);
    font-size: 0.9rem;
}

.bookmarks-empty p {
    margin: 0.5rem 0;
}

.bookmarks-hint {
    font-size: 0.8rem;
    opacity: 0.7;
}

.bookmarks-list {
    list-style: none;
    margin: 0;
    padding: 0;
    /* Prevent overflow */
    max-width: 100%;
    overflow: hidden;
}

.bookmark-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--MENU-SECTION-HR-color, #ddd);
    /* Prevent overflow */
    max-width: 100%;
    overflow: hidden;
}

.bookmark-item:last-child {
    border-bottom: none;
}

.bookmark-link {
    flex: 1;
    text-decoration: none;
    color: var(--MAIN-TEXT-color);
    /* Prevent overflow */
    min-width: 0;
    overflow: hidden;
}

.bookmark-link:hover .bookmark-item-title {
    color: var(--MAIN-LINK-color, #1e90ff);
}

.bookmark-item-title {
    display: block;
    font-size: 0.9rem;
    font-weight: 500;
    line-height: 1.3;
    transition: color 0.2s ease;
    /* Prevent overflow and wrap long titles */
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
}

.bookmark-item-meta {
    display: flex;
    gap: 0.75rem;
    font-size: 0.75rem;
    color: var(--MAIN-TEXT-color-DARK, #666);
    margin-top: 0.25rem;
}

.bookmark-item-section {
    text-transform: capitalize;
}

.bookmark-remove {
    background: none;
    border: none;
    color: var(--MAIN-TEXT-color-DARK, #999);
    cursor: pointer;
    padding: 0.25rem;
    opacity: 0.5;
    transition: opacity 0.2s ease, color 0.2s ease;
}

.bookmark-remove:hover {
    opacity: 1;
    color: #dc3545;
}

.bookmarks-clear-btn {
    width: 100%;
    margin-top: 1rem;
    padding: 0.5rem;
    background: transparent;
    border: 1px solid var(--MENU-SECTION-HR-color, #ddd);
    border-radius: 4px;
    color: var(--MAIN-TEXT-color-DARK, #666);
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.bookmarks-clear-btn:hover {
    border-color: #dc3545;
    color: #dc3545;
}

/* Hide on print */
@media print {
    .bookmarks-section {
        display: none !important;
    }
}
</style>

