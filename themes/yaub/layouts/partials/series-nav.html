{{/* Series Navigation Partial
     
     Usage in front matter:
     ---
     series: "My Series Name"
     series_part: 1
     ---
     
     Articles with the same "series" value will be linked together,
     ordered by "series_part" number.
*/}}

{{ if and .Params.series .Params.series_part }}
{{ $currentSeries := .Params.series }}
{{ $currentPart := .Params.series_part }}

{{/* Find all pages in the same series */}}
{{ $seriesPages := where .Site.RegularPages "Params.series" $currentSeries }}
{{ $seriesPages = sort $seriesPages "Params.series_part" }}
{{ $totalParts := len $seriesPages }}

{{ if gt $totalParts 1 }}
<div class="series-nav">
    <div class="series-header">
        <span class="series-icon"><i class="fas fa-layer-group"></i></span>
        <span class="series-title">{{ $currentSeries }}</span>
        <span class="series-progress">Part {{ $currentPart }} of {{ $totalParts }}</span>
    </div>
    
    <div class="series-parts">
        {{ range $index, $page := $seriesPages }}
        {{ $partNum := $page.Params.series_part }}
        <a href="{{ $page.RelPermalink }}" 
           class="series-part {{ if eq $partNum $currentPart }}current{{ end }}"
           title="{{ $page.Title }}">
            <span class="part-number">{{ $partNum }}</span>
            <span class="part-title">{{ $page.Title | truncate 40 }}</span>
        </a>
        {{ end }}
    </div>
    
    <div class="series-nav-buttons">
        {{ range $index, $page := $seriesPages }}
            {{ if eq $page.Params.series_part (sub $currentPart 1) }}
            <a href="{{ $page.RelPermalink }}" class="series-btn series-prev">
                <i class="fas fa-arrow-left"></i> Previous: {{ $page.Title | truncate 30 }}
            </a>
            {{ end }}
            {{ if eq $page.Params.series_part (add $currentPart 1) }}
            <a href="{{ $page.RelPermalink }}" class="series-btn series-next">
                Next: {{ $page.Title | truncate 30 }} <i class="fas fa-arrow-right"></i>
            </a>
            {{ end }}
        {{ end }}
    </div>
</div>
{{ end }}
{{ end }}

