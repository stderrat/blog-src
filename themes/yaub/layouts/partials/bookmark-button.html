{{/* Article Bookmark & Print Buttons */}}
{{ if .Section }}
<div class="bookmark-wrapper">
    <button class="bookmark-btn" 
            data-url="{{ .RelPermalink }}" 
            data-title="{{ .Title }}"
            data-section="{{ .Section }}"
            data-date="{{ .Date.Format "2006-01-02" }}"
            title="Save for later">
        <i class="far fa-bookmark bookmark-icon"></i>
        <span class="bookmark-text">Save</span>
    </button>
    <button class="print-btn" onclick="window.print()" title="Print this article">
        <i class="fas fa-print"></i>
        <span>Print</span>
    </button>
</div>

<script>
(function() {
    const STORAGE_KEY = 'blog-bookmarks';
    
    // Get all bookmarks from localStorage
    function getBookmarks() {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        } catch (e) {
            return [];
        }
    }
    
    // Save bookmarks to localStorage
    function saveBookmarks(bookmarks) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(bookmarks));
    }
    
    // Check if current article is bookmarked
    function isBookmarked(url) {
        return getBookmarks().some(b => b.url === url);
    }
    
    // Toggle bookmark state
    function toggleBookmark(btn) {
        const url = btn.dataset.url;
        const title = btn.dataset.title;
        const section = btn.dataset.section;
        const date = btn.dataset.date;
        
        let bookmarks = getBookmarks();
        const existingIndex = bookmarks.findIndex(b => b.url === url);
        
        if (existingIndex > -1) {
            // Remove bookmark
            bookmarks.splice(existingIndex, 1);
            updateButtonState(btn, false);
            showToast('Bookmark removed');
        } else {
            // Add bookmark
            bookmarks.unshift({
                url: url,
                title: title,
                section: section,
                date: date,
                savedAt: new Date().toISOString()
            });
            updateButtonState(btn, true);
            showToast('Article saved!');
        }
        
        saveBookmarks(bookmarks);
        updateBookmarkCount();
    }
    
    // Update button appearance
    function updateButtonState(btn, isBookmarked) {
        const icon = btn.querySelector('.bookmark-icon');
        const text = btn.querySelector('.bookmark-text');
        
        if (isBookmarked) {
            btn.classList.add('bookmarked');
            icon.classList.remove('far');
            icon.classList.add('fas');
            text.textContent = 'Saved';
        } else {
            btn.classList.remove('bookmarked');
            icon.classList.remove('fas');
            icon.classList.add('far');
            text.textContent = 'Save';
        }
    }
    
    // Show toast notification
    function showToast(message) {
        // Remove existing toast
        const existing = document.querySelector('.bookmark-toast');
        if (existing) existing.remove();
        
        const toast = document.createElement('div');
        toast.className = 'bookmark-toast';
        toast.innerHTML = '<i class="fas fa-check"></i> ' + message;
        document.body.appendChild(toast);
        
        // Trigger animation
        setTimeout(() => toast.classList.add('show'), 10);
        
        // Remove after 2 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 2000);
    }
    
    // Update bookmark count in sidebar (if element exists)
    function updateBookmarkCount() {
        const countEl = document.querySelector('.bookmarks-count');
        if (countEl) {
            const count = getBookmarks().length;
            countEl.textContent = count;
            countEl.style.display = count > 0 ? 'inline-block' : 'none';
        }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.querySelector('.bookmark-btn');
        if (btn) {
            // Set initial state
            updateButtonState(btn, isBookmarked(btn.dataset.url));
            
            // Add click handler
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                toggleBookmark(this);
            });
        }
        
        updateBookmarkCount();
    });
})();
</script>

<style>
.bookmark-wrapper {
    display: inline-flex;
    gap: 0.5rem;
    margin-left: 1rem;
}

.print-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.8rem;
    background: transparent;
    border: 1px solid var(--MENU-SECTION-HR-color, #ddd);
    border-radius: 20px;
    color: var(--MAIN-TEXT-color-DARK, #666);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.print-btn:hover {
    border-color: var(--MAIN-LINK-color, #1e90ff);
    color: var(--MAIN-LINK-color, #1e90ff);
}

.bookmark-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.8rem;
    background: transparent;
    border: 1px solid var(--MENU-SECTION-HR-color, #ddd);
    border-radius: 20px;
    color: var(--MAIN-TEXT-color-DARK, #666);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.bookmark-btn:hover {
    border-color: var(--MAIN-LINK-color, #1e90ff);
    color: var(--MAIN-LINK-color, #1e90ff);
}

.bookmark-btn.bookmarked {
    background: var(--BTN-BG-color-DARK, #1e90ff);
    border-color: var(--BTN-BG-color-DARK, #1e90ff);
    color: white;
}

.bookmark-btn.bookmarked:hover {
    background: var(--MAIN-LINK-HOVER-color, #1c7ed6);
    border-color: var(--MAIN-LINK-HOVER-color, #1c7ed6);
    color: white;
}

.bookmark-icon {
    font-size: 0.9rem;
    transition: transform 0.2s ease;
}

.bookmark-btn:hover .bookmark-icon {
    transform: scale(1.1);
}

.bookmark-btn.bookmarked .bookmark-icon {
    animation: bookmark-pop 0.3s ease;
}

@keyframes bookmark-pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}

/* Toast notification */
.bookmark-toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 0.9rem;
    z-index: 10000;
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bookmark-toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.bookmark-toast i {
    color: #28a745;
}

/* Hide on print */
@media print {
    .bookmark-wrapper,
    .bookmark-toast {
        display: none !important;
    }
}
</style>
{{ end }}

