---
title: "Advanced br-ex Configuration with Bonding on OpenShift"
description: "Configure/Migrate advanced br-ex bridge settings with network bonding for high availability and increased throughput on OpenShift clusters."
date: "2026-01-29"
doctype: book

authors: [Thomas Jungbauer]
type: post
draft: true

featured_image: /openshift-platform/networking/images/logos/Migrating_br-ex_Logo.png
show_featured_image_summary: true
show_featured_image_article: true
disableBreadcrumb: false

categories:
   - OpenShift
   - Networking
tags: ["OpenShift", "OCP", "Networking", "br-ex", "Bonding", "OVN-Kubernetes", "NMState"]

aliases: [
	 "/posts-output/2026-01-29-advanced-br-ex-bonding/",
]
---

:imagesdir: /openshift-platform/networking/images/br-ex-bonding/
:icons: font
:toc:


In standard OpenShift Container Platform (OCP) installations, the cluster networking operator relies on default scripts to configure the external bridge, **br-ex**. While these defaults work for simple setups, production environments frequently demand robust and redundancy setups, such as LACP bonding or active-backup configurations that the default scripts cannot guess.

In this article, we explore advanced configurations for the **br-ex** bridge on OpenShift.  We will configure a worker node with a high-availability active-backup bond, attach it to an OVS bridge (br-ex), and ensure the node maintains connectivity. 

<!--more-->

== Introduction

The **br-ex** (external bridge) is a critical component in OpenShift's OVN-Kubernetes network architecture. It handles external traffic flowing in and out of the cluster. By default, br-ex is attached to a single network interface, but in production environments, you often need:

* **High Availability**: If one network link fails, traffic continues through the remaining links
* **Increased Bandwidth**: Aggregate bandwidth from multiple interfaces
* **Load Balancing**: Distribute traffic across multiple physical connections

If you already have a cluster running, you can migrate your br-ex bridge to NMState in this article I tried to summarize the process step by step. 

NOTE: The official documentation can be found at link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.20/html-single/installing_on_bare_metal/index#migrating-br-ex-bridge-nmstate_bare-metal-postinstallation-configuration[Migrating a configured br-ex bridge to NMState].

== Why Customization is Necessary
By default, OVN-Kubernetes expects a bridge named br-ex to handle traffic exiting the cluster. If you need this bridge to sit on top of a specific bond (like bond-public) rather than a single physical interface, or if you need to enforce specific MAC address policies, you must intervene before the node boots into the cluster.

This method allows you to:

* Migrating br-ex bridge to NMState
* Define complex topologies (Bonds, VLANs, Bridges) declaratively.
* Persist configuration across reboots and upgrades via the Machine Config Operator.
* Decouple networking from the OS installation process.


== Prerequisites

Before configuring bonding with br-ex, ensure you have:

* OpenShift 4.x cluster with OVN-Kubernetes CNI
* NMState Operator installed ... not discussed in this article, but you can simply install and configure the NMState Operator
* Multiple network interfaces available on your nodes
* Understanding of your network topology and switch configuration

== Understanding Bonding Modes

Linux supports several bonding modes. The most common ones for OpenShift deployments and supported by OpenShift Virtualization are:

[cols="1,2,3"]
|===
|Mode |Name |Description

|1
|active-backup
|Only one interface active at a time. Failover when active fails.

|2
|balance-xor
|XOR-based load balancing. Requires switch configuration.

|3
|802.3ad (LACP)
|Dynamic link aggregation. Requires switch support for LACP.

|===

NOTE: Mode LACP is recommended for production environments **when switch support is available**, as it provides both redundancy and load balancing.









== Configuring Bonding with NMState

The NMState Operator allows you to declaratively configure network settings on OpenShift nodes using the `NodeNetworkConfigurationPolicy` (NNCP) custom resource.

=== Example: Active-Backup Bond Configuration

The following example creates a bond interface using active-backup mode:

[source,yaml]
----
apiVersion: nmstate.io/v1
kind: NodeNetworkConfigurationPolicy
metadata:
  name: br-ex-bond-active-backup
spec:
  nodeSelector:
    node-role.kubernetes.io/worker: "" <1>
  desiredState:
    interfaces:
      - name: bond0 <2>
        type: bond
        state: up
        ipv4:
          enabled: false
        link-aggregation:
          mode: active-backup <3>
          port:
            - ens192 <4>
            - ens224
          options:
            miimon: "100" <5>
            primary: ens192 <6>
      - name: br-ex <7>
        type: ovs-bridge
        state: up
        bridge:
          port:
            - name: bond0
----
<1> Apply this policy to worker nodes
<2> Name of the bond interface
<3> Bonding mode: active-backup for failover
<4> Physical interfaces to bond together
<5> Link monitoring interval in milliseconds
<6> Primary interface when both links are up
<7> Attach the bond to br-ex bridge

=== Example: LACP (802.3ad) Bond Configuration

For environments with LACP-capable switches:

[source,yaml]
----
apiVersion: nmstate.io/v1
kind: NodeNetworkConfigurationPolicy
metadata:
  name: br-ex-bond-lacp
spec:
  nodeSelector:
    node-role.kubernetes.io/worker: ""
  desiredState:
    interfaces:
      - name: bond0
        type: bond
        state: up
        ipv4:
          enabled: false
        link-aggregation:
          mode: 802.3ad <1>
          port:
            - ens192
            - ens224
          options:
            miimon: "100"
            lacp_rate: fast <2>
            xmit_hash_policy: layer3+4 <3>
      - name: br-ex
        type: ovs-bridge
        state: up
        bridge:
          port:
            - name: bond0
----
<1> LACP mode for dynamic link aggregation
<2> LACP rate: fast (1 second) or slow (30 seconds)
<3> Hash policy for load balancing decisions

== Verifying the Configuration

After applying the NNCP, verify the configuration on your nodes:

[source,bash]
----
# Check bond status
oc debug node/<node-name> -- chroot /host cat /proc/net/bonding/bond0

# Verify br-ex bridge
oc debug node/<node-name> -- chroot /host ovs-vsctl show

# Check NMState status
oc get nncp br-ex-bond-active-backup -o yaml
----

== Troubleshooting

=== Common Issues

**Bond not forming:**

* Verify both interfaces are physically connected
* Check switch port configuration matches bonding mode
* Review NMState logs: `oc logs -n openshift-nmstate deployment/nmstate-handler`

**Traffic not flowing:**

* Verify br-ex is properly attached to the bond
* Check OVN-Kubernetes pods are running
* Review node network configuration: `oc debug node/<node-name> -- chroot /host nmcli connection show`

== Conclusion

Configuring br-ex with bonding provides essential redundancy and can improve network throughput for your OpenShift cluster. Choose the appropriate bonding mode based on your switch capabilities and requirements:

* Use **active-backup** for simple failover without switch configuration
* Use **802.3ad (LACP)** for optimal redundancy and load balancing when switches support it
* Use **balance-alb** when you need load balancing but lack switch support

Always test your configuration in a non-production environment before applying to production clusters.
