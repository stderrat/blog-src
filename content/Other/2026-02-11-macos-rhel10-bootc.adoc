---
title: "Creating a RHEL 10 VM on MacOS with bootc-image-builder"
description: "Creating a RHEL 10 VM on MacOS with bootc-image-builder"
date: "2026-02-10"
doctype: book
weight: 10

draft: true

featured_image: /other/images/homelab/homelab_logo.png
show_featured_image_summary: true
show_featured_image_article: true
disableBreadcrumb: false

authors: [Toni Schmidbauer]
type: post
categories:
   - MacOS
   - UTM
   - RHEL10
   - bootc
   - bootc-image-builder
   - Virtualization

tags: ["Other", "Home Lab", "RHEL", "Containers", "bootc"]

aliases: [
]
---

:imagesdir: /other/images/homelab/
:icons: font
:toc:

Yes, we have Apple machines in our lab because why not. So we needed a
RHEL 10 VM to setup Ansible Automation Platform, which seems to
support AARCH64 and Red Hat Enterprise Linux 10.

<!--more-->

We need https://mac.getutm.app/[UTM] install on our Mac machine,
either via
https://github.com/utmapp/UTM/releases/latest/download/UTM.dmg[manually],
via https://formulae.brew.sh/cask/utm[Homebrew] or via a Nix
https://github.com/tosmi/nixos-config/blob/7faff0ed92d4bbefbef42641497cd2aa49c54b83/macos/fuji/flake.nix#L146[flake]
(in order of increasing coolness).

Podman is also required, same rules as above apply:

- https://podman-desktop.io/[manual installation]
- https://formulae.brew.sh/cask/podman-desktop[Homebrew]
- https://github.com/tosmi/nixos-config/blob/3a6bc775d3164d080390590522956ad5399a34c6/macos/fuji/flake.nix#L147[flake.nix]

We followed the
https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/10/html/using_image_mode_for_rhel_to_build_deploy_and_manage_operating_systems/creating-bootc-compatible-base-disk-images-by-using-bootc-image-builder[RHEL
documentation] for created a bootable qcow image from a bootc
container image.

According to the https://github.com/osbuild/bootc-image-builder?tab=readme-ov-file#-installation[upstream image builder docs], we need to make sure
that our podman machine runs rootful. Otherwise image builder will not
work.

[source,bash]
----------
$ podman machine stop
$ podman machine set --rootful
$ podman machine start
$ podman machine info
----------


Next we need to pull the _bootc-image-builder_ image:

[source,bash]
----------
$ podman pull registry.redhat.io/rhel10/bootc-image-builder
----------

Then we can pull the RHEL 10 bootc container, as _bootc-image-builder_ is not able to pull container images:

[source,bash]
----------
podman pull registry.redhat.io/rhel10/rhel-bootc:latest
----------

For running the image builder we created a tmp directory and a _toml_
config file to configure the final qcow image:

[source,bash]
----------
mkdir -p rhel10-bootc/output
cd rhel10-bootc
----------

https://access.redhat.com/labs/kickstartconfig/

https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/10/html/automatically_installing_rhel/kickstart-commands-and-options-reference

One import note from the documentation (quoted):

NOTE: The following combined customizations are not supported: [customizations.user] and [customizations.installer.kickstart]. When you add a Kickstart, use a configuration file in the TOML format, because multi-line strings are prone to error.

Our _config.toml_ file with customizations:

[source,toml]
----------
[[customizations.user]]
name = "pinhead"
password = "ta1w4n"
key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIYhjnWzsArZVyyTa1E6sDbH06rUGDAhAF3bf3pmeBtm toni@stderr.at"
groups = ["wheel"]

[[customizations.filesystem]]
mountpoint = "/"
minsize = "50 GiB"
----------

Now we are ready to trigger _bootc-image-builder_:

[source,bash]
----------
sudo podman run \
    --rm \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    -v ./config.toml:/config.toml:ro \
    -v ./output:/output \
    registry.redhat.io/rhel10/bootc-image-builder:latest \
    --type qcow2 \
    --config /config.toml \
  registry.redhat.io/rhel10/rhel-bootc:latest
----------
